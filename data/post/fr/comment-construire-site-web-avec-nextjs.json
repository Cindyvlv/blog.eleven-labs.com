{"date":"2022-01-31T00:00:00.000Z","title":"Comment construire son site web avec NextJS ?","excerpt":"Dans cet article, vous apprendrez les basiques de NextJS requis pour construire un site web !","readingTime":"12mn","authors":["aamara"],"categories":["javascript"],"content":"\nCe post aborde les bases de NextJS. \nNous allons construire un site web simple à l'aide de ce framework.\n\n## Qu'est-ce que NextJS ?\n\nNextJS est un framework permettant de construire tout type d'application React. Il est spécialisé dans le rendu des composants côté serveur (SSR), mais il supporte aussi la génération statique (SSG). De ce fait l'application peut être facilement hébergée sur différents types de services, sur un SI, depuis un serveur web HTTP (pour le rendu SSG) jusqu'à un serveur NodeJS pour le rendu des composants côtés serveur.\n\nOn peut alors se poser la question : pourquoi devrais-je utiliser NextJS pour construire mon site web ?\n\n## Pourquoi construire son site web avec NextJS\n\nVoyons quels sont les avantages d'utiliser NextJS pour un site web :\n\n* React : un des frameworks orientés composant les plus populaires. Il permet de construire facilement des interfaces efficaces pour le web. Si vous êtes un développeur React vous serez en terrain connu.\n* On peut générer les fichiers statiques et déployer le site web facilement sur un serveur HTTP basique ou encore sur un bucket type S3 chez n'importe quel cloud provider.\n* Le framework est facile à installer et il est pré-configuré. On peut donc rapidement commencer les développements sans prise de tête.\n\nDans la prochaine section, nous allons apprendre à utiliser NextJS en construisant un petit site web.\n\n## Projet exemple : AstroTeams\n\nNous allons construire un site web qui présente les équipes d'astronautes d'Eleven Labs.\nPremière chose à faire : installer le projet.\n\n### Installation du projet NextJS\n\nPour suivre ce tutoriel il est fortement recommandé de cloner le dépôt Git d'exemple. Nous allons apprendre à construire les différentes pages du site web et nous n'allons pas apprendre comment construire le contenu, les composants.\n\nLe Git contient l'ensemble des composants React nécessaires pour l'affichage du contenu des pages web. L'ensemble de ces composants est dans le dossier `components`.\n\nClonons le dépôt git et plaçons-nous sur la branche \"get-started\" :\n\n```shell\ngit clone https://gitlab.com/Tonypunisher/astroteams.git\ngit checkout get-started\n```\n\n> **Note**: Si vous avez besoin de créer un projet vide, le paquet create-next-app est là pour ça.\n> ```shell\n> npx create-next-app astroteams\n> ```\n\n### Création de la page d'accueil\n\nPour commencer, on supprime le contenu du fichier `pages/index js`, pour avoir une page blanche et non la page d'accueil de Next Js.\nMaintenant, nous avons besoin de construire le layout de notre site. Pour ça on va créer un composant React qui sera réutilisé par le composant App de NextJS pour chaque page générée.\n\n> **Note** : l'ensemble des pages est dans le dossier `pages`.\n\n### Construction du layout\n\nTout d'abord, on crée le dossier `components` s'il n'existe pas :\n\n```shell\nmkdir components\n```\n\nEnsuite, on crée les fichiers pour le composant Layout :\n\n```shell\nmkdir components/Layout\ntouch components/Layout/Layout.js\ntouch components/index.js\ntouch components/Layout.module.css\n```\n\nIl nous reste à ajouter le contenu du composant et les règles CSS associées :\n\n`components/Layout.js`\n```js\n// Libs\nimport PropTypes from \"prop-types\"\nimport Head from \"next/head\";\nimport { useRouter } from \"next/router\";\n\n// Components\nimport { FlexContainer, ORIENTATION } from \"../FlexContainer\";\nimport { ElevenLabsLogo } from \"../ElevenLabsLogo/ElevenLabsLogo\";\nimport { SpaceCraftButton } from \"../SpaceCraftButton\";\n\n// CSS Module\nimport styles from \"./Layout.module.css\";\nimport Image from \"next/image\";\n\nexport function Layout({ children: pageContent }) {\n  const router = useRouter()\n  const isHomePage = router.pathname === \"/\"\n\n  const handleContactClick = (e) => {\n    e.preventDefault()\n    router.push(\"/contact\")\n  }\n\n    return <div className={styles[\"main-container\"]}>\n    <Head>\n      <title>AstroTeams</title>\n      <meta name=\"description\" content=\"Eleven Labs Astro Teams\" />\n      <link rel=\"icon\" href=\"/favicon.ico\" />\n    </Head>\n\n    <main className={styles.main}>\n      <FlexContainer orientation={ORIENTATION.VERTICAL}>\n        <ElevenLabsLogo />\n        { pageContent }\n      </FlexContainer>\n      { isHomePage && <SpaceCraftButton onClick={handleContactClick}>Contact</SpaceCraftButton> }\n    </main>\n\n    <footer className={styles.footer}>\n      <Image\n        alt=\"Eleven Labs Logo\"\n        src=\"/logo-eleven-labs-large.png\"\n        objectFit=\"contain\"\n        width=\"150px\"\n        height=\"50px\"\n        priority\n      />\n      <div className={styles[\"footer__label\"]}>NextJS Demo App</div>\n    </footer>\n  </div>\n}\n\nLayout.propTypes = {\n  /**\n   * Page content\n  */\n  children: PropTypes.node.isRequired,\n}\n```\n\n> **Note** : n'oubliez pas d'ajouter les règles de styles dans le module CSS. De plus, il faut exporter le composant Layout dans le fichier index.js.\n\nEnfin, on ajoute le Layout dans le fichier `pages/_app.js` :\n\n```js\n// Components\nimport { Layout } from \"../components/Layout\"\n\n// Global CSS\nimport \"../styles/globals.css\"\n\nfunction MyApp({ Component, pageProps }) {\n  return <Layout><Component {...pageProps} /></Layout>\n}\n\nexport default MyApp\n```\n\nChaque page générée utilise notre Layout. On peut le constater sur la page d'accueil :\n\n![astro teams layout](/imgs/posts/2022-01-26-build-website-with-nextjs/website-layout.png)\n\nIl nous reste à ajouter le contenu de la page d'accueil.\n\n### Création du contenu de l'accueil\n\nOn ajoute le HTML de la page avec du JSX :\n\n```js\n// Libs\nimport Head from \"next/head\";\nimport { useRouter } from \"next/router\";\n\n// Components\nimport { FlexContainer } from \"../components/FlexContainer\";\nimport { Card } from \"../components/Card/Card\";\nimport { Button } from \"../components/Button\"\n\n// CSS Module\nimport styles from \"../styles/Home.module.css\";\n\nexport default function Home() {\n  const router = useRouter()\n  const handleTeamPageClick = (e, team) => {\n    e.preventDefault()\n    router.push(`/${team}`)\n  }\n\n  return (\n    <>\n      <h2>Eleven Labs Astronauts Teams</h2>\n      <FlexContainer>\n        <Card backgroundColorClass=\"blue-background\" imagePath=\"/cats-logo.png\" imageAlt=\"Eleven Labs Cats Team\" title=\"Schizo Cats\">\n          <div className={styles[\"team-description\"]}>\n            <div className={styles[\"team-description__txt\"]}>Crazy cats from the kitty planet.</div>\n            <Button className=\"blue-background\" onClick={(e) => handleTeamPageClick(e, \"schizo-cats\")}>READ MORE</Button>\n          </div>\n        </Card>\n        <Card backgroundColorClass=\"green-background\" imagePath=\"/ducks-logo.png\" imageAlt=\"Eleven Labs Duck Team\" title=\"Duck Invaders\">\n          <div className={styles[\"team-description\"]}>\n            <div className={styles[\"team-description__txt\"]}>Ducks space invaders from Duck planet.</div>\n            <Button className=\"green-background\" onClick={(e) => handleTeamPageClick(e, \"ducks-invaders\")}>READ MORE</Button>\n          </div>\n        </Card>\n        <Card backgroundColorClass=\"red-background\" imagePath=\"/pandas-logo.png\" imageAlt=\"Eleven Labs Pandas Team\" title=\"Donut Factory\">\n          <div className={styles[\"team-description\"]}>\n            <div className={styles[\"team-description__txt\"]}>Pandas who made some donuts from the Donuts planet.</div>\n            <Button className=\"red-background\" onClick={(e) => handleTeamPageClick(e, \"donuts-factory\")}>READ MORE</Button>\n          </div>\n        </Card>\n        <Card backgroundColorClass=\"yellow-background\" imagePath=\"/racoon-logo.png\" imageAlt=\"Eleven Labs Racoon Team\" title=\"Raccoons of Asgard\">\n          <div className={styles[\"team-description\"]}>\n            <div className={styles[\"team-description__txt\"]}>Racoons guardian of the galaxy from the great Asgard planet.</div>\n            <Button className=\"yellow-background\" onClick={(e) => handleTeamPageClick(e, \"asgard-racoons\")}>READ MORE</Button>\n          </div>\n        </Card>\n      </FlexContainer>\n    </>\n  )\n}\n```\n\n> **Note** : Ne pas oublier d'ajouter les règles CSS. Le fichier correspondant est `styles/home.module Css`. L'ensemble des modules CSS pour les pages est stocké dans ce dossier.\n\n![Website Home Page](/imgs/posts/2022-01-26-build-website-with-nextjs/homepage.png)\n\nLes composants `pages/index js` et `components/Layout js` contiennent des redirections vers d'autres pages, qui n'existent pas pour l'instant. Nous allons apprendre comment créer ces pages avec NextJS.\n\n### Créer une page simple\n\nNous avons besoin de créer une page statique pour y mettre les informations de contacts. Par page statique, je veux dire que cette page ne prend pas de paramètre via l'URL. Pour créer une page `/contact`, il faut ajouter un fichier `contact js` avec un composant React qui renvoie au moins un élément vide. Le routeur de NextJS va se charger de créer la page :\n\n```shell\ntouch pages/contact.js\n```\n\n`pages/contact.js`:\n```js\n// Components\nimport { PageCard } from \"../components/PageCard\"\nimport { FlexContainer, ORIENTATION } from \"../components/FlexContainer\"\n\nexport default function Contact() {\n    return <>\n    </>\n}\n```\n\nNous avons maintenant une page vide, ajoutons son contenu :\n\n```js\n// Components\nimport { PageCard } from \"../components/PageCard\"\nimport { FlexContainer, ORIENTATION } from \"../components/FlexContainer\"\n\nexport default function Contact() {\n    return <>\n        <h2>Contact Eleven Labs</h2>\n        <PageCard>\n            <FlexContainer orientation={ORIENTATION.VERTICAL}>\n                <h3>Eleven Labs</h3>\n                <div>PARIS</div>\n                <div>15, avenue de la Grande Armée</div>\n                <div>75116 PARIS</div>\n                <div><a href=\"mailto:contact@eleven-labs.com\">contact@eleven-labs.com</a></div>\n            </FlexContainer>\n        </PageCard>\n    </>\n}\n```\n\n![Contact Page](/imgs/posts/2022-01-26-build-website-with-nextjs/contactpage.png)\n\nMaintenant que nous avons une page de contact, il nous faut une page par équipe. Pour ça, on va créer une seule page avec le nom de l'équipe en paramètre.\n\n### Créer une page/route avec paramètre\n\nLe routeur de NextJS permet de créer facilement une page avec des paramètres d'URL. Pour cela, on va créer un fichier avec un nom spécifique. Dans notre cas, on veut une page `/<teamname>`, on crée alors un fichier `pages/[team].js`.\n\nNous avons maintenant créé notre page. Il nous faut parser le paramètre de l'URL et le passer en propos au composant. Nous devons pour ça créer 2 fonctions :\n\n* **getStaticPath** : une fonction qui retourne l'ensemble des URLs possibles pour notre page. Dans notre cas nous renverrons un tableau avec 4 URLs, une pour chaque équipe.\n* **getStaticProps** : une fonction qui retourne les propos à partir du paramètre d'URL courant.\n\nMais avant d'ajouter ces 2 fonctions, ajoutons le contenu textuel pour l'affichage dans un fichier JSON :\n\n`pages/api/teams.json`:\n```json\n[\n    { \"name\": \"schizo-cats\", \"teamName\": \"Schizo Cats\", \"teamDescription\": \"Crazy cats from the kitty planet.\", \"teamImagePath\": \"/cats-logo.png\", \"teamPlanetPath\": \"/planet-skizo.png\", \"teamCounter\": 25, \"teamPosition\": \"3rd\" },\n    { \"name\": \"ducks-invaders\", \"teamName\": \"Duck Invaders\", \"teamDescription\": \"Ducks space invaders from Duck planet.\", \"teamImagePath\": \"/ducks-logo.png\", \"teamPlanetPath\": \"/planet-ducks.png\", \"teamCounter\": 20, \"teamPosition\": \"2nd\" },\n    { \"name\": \"donuts-factory\", \"teamName\": \"Donut Factory\", \"teamDescription\": \"Pandas who made some donuts from the Donuts planet.\", \"teamImagePath\": \"/pandas-logo.png\", \"teamPlanetPath\": \"/planet-pandas.png\", \"teamCounter\": 25, \"teamPosition\": \"4th\" },\n    { \"name\": \"asgard-racoons\", \"teamName\": \"Raccoons of Asgard\", \"teamDescription\": \"Racoons guardian of the galaxy from the great Asgard planet.\", \"teamImagePath\": \"/racoon-logo.png\", \"teamPlanetPath\": \"/planet-racoon.png\", \"teamCounter\": 20, \"teamPosition\": \"1st\" }\n]\n```\n\nImplémentons la fonction getstaticpath basée sur les éléments du fichier JSON :\n\n`pages/[team].js`:\n```js\nexport async function getStaticPaths() {\n    const paths = teamsData.map(team => {\n        return {\n            params: { team: team.name }\n        }\n    })\n\n    return { paths, fallback: false }\n}\n```\n\nCette fonction construit un tableau d'URLs qui contient un élément path basé sur le nom de chaque équipe. L'option fallback ajoute une contrainte. Il faut relancer la phase de build pour générer de nouvelles pages.\n\nOn peut maintenant construire les props pour notre page :\n\n`pages/[team].js`\n```js\nexport function getStaticProps({ params }) {\n    const { teamName, teamDescription, teamImagePath, teamPlanetPath, teamCounter, teamPosition } = teamsData.find(team => team.name === params.team)\n\n    return { props: { teamName, teamDescription, teamImagePath, teamPlanetPath, teamCounter, teamPosition } }\n}\n```\n\nOn a recherché les éléments utiles grâce au tableau construit précédemment. Il nous reste à créer le contenu de la page :\n\n`pages/[team].js`:\n```js\nexport default function Team({ teamName, teamDescription, teamImagePath, teamPlanetPath, teamCounter, teamPosition }) {\n    return <TeamCard\n        teamName={teamName}\n        teamDescription={teamDescription}\n        teamImagePath={teamImagePath}\n        teamPlanetPath={teamPlanetPath}\n        teamCounter={teamCounter}\n        teamPosition={teamPosition}\n    />\n}\n```\nIci on passe nos propos à un composant qui rend les éléments de la page. Dorénavant, si on clique sur le bouton \"read more\", on verra la page de détails d'une équipe.\n\n![Team Page](/imgs/posts/2022-01-26-build-website-with-nextjs/teampage.png)\n\nNous avons maintenant un site web prêt à être mis en production.\n\n## Feedback\n\nPour conclure, quelques points sur la construction d'un site web avec NextJS :\n\n* Environnement pré-configuré : tout est facile à initialiser et des outils permettent de suivre des bonnes pratiques comme ESLint. Bien que la configuration d'ESLint soit basique, c'est un bon départ.\n* React : si on a déjà développé avec React il est très facile de construire son site web. De plus on peut réutiliser des composants provenant de l'open source.\n* Le déploiement : il y a plusieurs possibilités différentes pour mettre le site web en production.\n* Optimisation : NextJS optimise certains éléments comme les images, ou encore le chargement de la page pour améliorer le référencement naturel, ce qui est avantageux.\n\nVoilà, j'espère que cet article vous aura plu ! \n"}