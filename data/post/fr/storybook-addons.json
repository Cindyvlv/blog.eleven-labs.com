{"date":"2020-01-02T00:00:00.000Z","title":"Storybook - Découvrir les addons","excerpt":"Deuxième épisode de cette série, découvrez les incroyables addons sur Storybook. C'est JUSTE des gamebreakers.","readingTime":"7mn","authors":["manu"],"categories":["javascript"],"content":"\n![Liste d'addon 1](/imgs/posts/2020-01-02-Storybook-Addons/addonlist.png)\n\nCoucou les bichons, on se retrouve pour un nouvel article qui porte sur les Addons !\n\n> Attends, attends... Tu devais pas faire un article sur le Testing ou la Documentation ?\n\nAlors oui, mais vu l'importance de la contribution des addons sur ce sujet, il aurait été bien dommage de ne pas en parler avant ! Mais pas de soucis, ces 2 sujets sont déjà dans les tuyaux.\n\nPour rappel, dans le précédent article, nous avons vu ensemble que Storybook est un environnement de développement de composants. Son but est de simplifier cette tâche en fournissant des `stories` qui servent de guidelines/spec pour les composants, améliorant l'exportabilité et la résilience générale.\n\n## Clique sur la cloche et Addon toi\n\nBon, je pense qu'on sait tous ce qu'est une extension ou un module complémentaire :\n\nCe truc qui viens très souvent remplacer une tâche dont t'as bien la flemme au bout d'une semaine, et que tu sacrifies sur l'autel des ralentissements au démarrage.\n\nAvant de cracher davantage dans la soupe, laissons quand même la parole au cuisinier, car qui mieux que Storybook pour vendre sa propre came ?\n\n> **Supercharge Storybook**\n> Storybook addons enable advanced functionality and unlock new workflows. Contributed by core maintainers and the amazing developer community.\n\nDonc on nous promet des supers modules qui viennent enrichir notre expérience, maintenus par Storybook et leur communauté ? Ça transpire pas l'originalité, mais ça a le mérite qu'on lui laisse une chance.\n\nOn pourrait presque être rabat-joie en se disant que c'est juste une mode d'ouvrir son projet aux addons communautaires... mais là, Storybook à vraiment l'air d'avoir pris les choses très au sérieux.\n\nDéjà le nombre d'addons est moins important que le nombre de vendeurs de tours Eiffel au Trocadéro, on en dénombre 13 officiels et 27 communautaires, ça présage déjà de la part belle à la qualité et au besoin, plutôt qu'à la quantité.\n\n![Liste d'addon 2](/imgs/posts/2020-01-02-Storybook-Addons/addonlist2.png)\n\nDans les faits ces derniers sont rangés par fonctionnalité : **Organisation**, **Test, Code**, **Data & State**, **Style** et pour finir **Design**.\n\nEnsuite, l'intérêt de ces modules est communautaire, on rappelle que le but de ce projet est de simplifier la vie de ceux qui l'utilisent : PO, UX designer, dev.\n\nPar exemple, pour nous les petites mains du code, le but est de tester la réaction de notre composant à plusieurs états.\n\nC'est donc tout naturellement que la communauté contribue en fournissant des outils pour permettre de moquer les comportements qu'ils rencontrent au quotidien, permettant ainsi d'intégrer à Storybook un composant connecté à un store Redux, soumis à un contexte comme le [ThemeProvider](https://www.styled-components.com/docs/advanced) de [Material-UI](https://material-ui.com/customization/theming/), bourré de Query/Mutation GraphQL, de l'internationalisation jusqu'à l'accessibilité.\n\nEn fait, c'est ce qui fait que Storybook puisse être pertinent, il s'intègre dans l'écosystème de React tout en assumant son rôle.\n\nBon là je vous sens déjà plus intéressés, est-ce qu'on s'en installerait pas un ou deux, comme ça, pour le plaisir ?\n\n## Un fichier pour les gouverner tous\n\nLa dernière fois, on a vu les possibilités qu'offrait le fichier story pour soumettre notre composant à plusieurs états.\n\nJe sais que vous en rêvez encore la nuit mais pour les insomniaques, un petit rappel :\n\n```javascript\n    import React from 'react';\n    import { storiesOf } from '@storybook/react';\n    import { action } from '@storybook/addon-actions';\n\n    import Task from './Task';\n\n    export const task = {\n        id: '1',\n        title: 'Prévenir Jeanine',\n        state: 'TASK_INBOX',\n        updatedAt: new Date(2018, 0, 1, 9, 0)\n    };\n\n    export const actions = {\n        onPinTask: action('onPinTask'),\n        onArchiveTask: action('onArchiveTask')\n    };\n\n    storiesOf('Task', module)\n    .add('default', () => <Task task={task} {...actions} />)\n    .add('pinned', () => <Task task={\\{...task, state: 'TASK_PINNED'}} {...actions} />)\n    .add('archived', () => <Task task={\\{...task, state: 'TASK_ARCHIVED'}} {...actions} />);\n```\n\nComme on est des grosses flemasses, nous on voudrait bien ne pas avoir à éditer ce fichier, le sauvegarder et revenir sur notre storybook pour avoir notre retour visuel...\n\nUn peu comme ça non ?\n\n![Storybook knobs addon](/imgs/posts/2020-01-02-Storybook-Addons/knobs.gif)\n\nC'est cadeau, c'est l'addon **Knobs** comme on peut voir dans le petit onglet, juste à côté d'**Actions**, qui lui aussi est un addon qu'on a utilisé dans le tutoriel d'avant (celui qui permet de mocker des callbacks type `onClick()` par exemple) et qui est déjà présent dans notre fichier story :\n\n```javascript\n    // src/components/Task.stories.js\n    (...)\n    import { action } from '@storybook/addon-actions';\n\n    (...)\n\n    export const actions = {\n        onPinTask: action('onPinTask'),\n        onArchiveTask: action('onArchiveTask')\n    };\n```\n\nOn va donc s'empresser d'ajouter notre nouvel addon **Knobs :**\n\n`yarn add @storybook/addon-knobs`\n\nPuis on fait un petit tour dans le fichier `.storybook/addon.js` où l'on doit **register** notre addon\n\n```javascript\n// .storybook/addons.js\n\nimport \"@storybook/addon-actions/register\";\nimport \"@storybook/addon-knobs/register\";\n```\n\nC'est tout ! 😏\n\nOn va donc immédiatement éditer le code de notre story\n\n```javascript\n    // src/components/Task.stories.js\n\n    (...)\n    import { withKnobs, object } from '@storybook/addon-knobs/react';\n\n    (...)\n\n    storiesOf('Task', module)\n      .addDecorator(withKnobs) // on passe withKnobs en argument à addDecorator()\n    \t// On passe object('knobName', props) pour trigger l'addon sur l'UI Storybook\n    \t.add('default', () => {\n        return <Task task={object('superArticleManu', { ...task })} {...actions} />;\n      })\n      .add('pinned', () => <Task task={\\{ ...task, state: 'TASK_PINNED' }} {...actions} />)\n      .add('archived', () => <Task task={\\{ ...task, state: 'TASK_ARCHIVED' }} {...actions} />);\n```\n\n![Storybook knobs addon](/imgs/posts/2020-01-02-Storybook-Addons/knobs1.png)\n\nEt là imaginez, vous filez ça à Jean-Marie qui est en charge de tester votre composant. Il va s'éclater à voir si vous avez pas fait de la daube pour revenir vers vous, avec une haleine de cendrier et de café froid, en vous beuglant :\n\n> Eh mec ! T'as vu la gueule de ton composant ? Quand j'ai mis un titre un peu long ? Non mais je te jure... hahaha\n\n![Storybook knobs addon 2](/imgs/posts/2020-01-02-Storybook-Addons/knobs2.png)\n\nQuel coquin ce Jean-Marie, mais il n'a pas tort. On peut simplement se rajouter une nouvelle story \"long titre\" pour sauvegarder ce use-case et éviter la régression.\n\n```javascript\n    // src/components/Task.stories.js\n\n    const longTitre = \"Une phrase bien longue, du genre, que tu ne mettras jamais dans une tâche à faire, mais là Charles-Edouard il tiens un truc t'inquiète\"\n\n    storiesOf('Task', module)\n      .add('default', () => <Task task={task} {...actions} />)\n      .add('pinned', () => <Task task={\\{ ...task, state: 'TASK_PINNED' }} {...actions} />)\n      .add('archived', () => <Task task={\\{ ...task, state: 'TASK_ARCHIVED' }} {...actions} />)\n      .add('long titre', () => <Task task={\\{ ...task, title: longTitre }} {...actions} />);\n```\n\nVoilà voilà, c'est déjà fini les copains ! Mais promis on se revoit vite pour regarder ensemble, à travers deux articles, comment qu'on fait pour avoir de très beaux **Tests structurels** et aussi une très belle **Documentation de composant**, genre documentation de Material UI, mais sans effort.\n\nJe pense fort à vous, hésitez pas à venir me claquer une bise si ça vous a plu.\n\n## À bientôt les bichons 👋\n"}