{"date":"2017-05-29T00:00:00.000Z","title":"AMP le futur du web ?","excerpt":"Google, leader incontesté des services web (recherche, pub, analytics...), propose depuis plus d'un an une nouvelle façon d'afficher vos pages, désignée sous le nom AMP project","readingTime":"7mn","authors":["captainjojo"],"categories":["javascript"],"content":"Google, leader incontesté des services web (recherche, pub, analytics...), propose depuis plus d'un an une nouvelle façon d'afficher vos pages, désignée sous le nom [AMP](https://www.ampproject.org/){:rel=\"nofollow noreferrer\"} project.\n\n### Mais ça donne quoi ?\n\nSi vous suivez à fond l'ensemble des actualités médiatiques et que vous utilisez énormément la recherche google, vous avez sûrement vu apparaître les \"cartes\" suivantes lors de vos recherches mobile :\n\n![](/imgs/posts/2017-05-29-amp-est-le-futur/croped-1.png)\n\nEt oui, c'est cela AMP. Une place de choix dans la recherche Google, mais aussi une nouvelle façon de naviguer entre les sites. En effet, si vous cliquez sur une des cartes vous ne serez pas sur le site qui a envoyé le contenu (on comprendra pourquoi plus tard) mais vous resterez chez Google, qui vous permettra de \"slider\" entre chaque page de la recherche :\n\n![](/imgs/posts/2017-05-29-amp-est-le-futur/capture-decran-2017-05-29-a-10.38.18.png)\n\nIntéressant non ? Mais ce n'est pas tout, si vous regardez plus attentivement vous vous rendrez compte que le site AMP est énormément plus rapide que votre site lui-même.\n\n### Mais comment ça marche ?\n\nLe projet se repose sur 3 composants permettant de proposer cette nouvelle expérience utilisateur :\n\n- AMP HTML\n\nAMP est par défaut du HTML classique, mais dans certain cas de nouvelles balises sont mises en place pour permettre une rapidité d'exécution accrue. Vous avez par exemple \n\n```html\n<amp-img>\n```\n\nqui va permettre un affichage plus rapide des images et cela même pour les navigateurs non compatibles. AMP interdit aussi l'utilisation de certaine balises considérées comme inutiles ou non performantes. Vous êtes donc restreint sur l'utilisation des balises suivantes, \n\n```html\n<object>\n```\n\n, \n```html\n<param>\n```\n, etc...\n\n- AMP JS\n\nAMP propose une nouvelle utilisation de javascript dans vos pages web, au moyen d'une liste exhaustive de librairies javascript optimisées. Vous pouvez en trouver la liste [ici](https://github.com/ampproject/amphtml/tree/master/src){:rel=\"nofollow noreferrer\"}. Mais l'optimisation principale réside en la *désynchronisation* des librairies javascript externes à votre site. C'est d'ailleurs pour cela que la plupart des pages AMP  ne proposent pas de publicité. Cette dernière reste la hantise de la web performance.\n\n- AMP Cache\n\nAMP cache est en option mais c'est tout de même le point central d'AMP. Vous avez toujours rêvé d'avoir accès à l'un des meilleurs systèmes de cache du monde ? C'est maintenant possible : AMP Cache permet de stocker vos pages AMP directement dans le cache Google. C'est pour cela que vous n'êtes plus sur votre site mais directement sur www.google.com. Cela permet une optimisation exponentielle de la performance de votre page.\n\nPour aller plus loin dans la description des principes d'AMP je vous invite à lire cette article [https://www.ampproject.org/fr/learn/amp-design-principles/](https://www.ampproject.org/fr/learn/about-how/){:rel=\"nofollow noreferrer\"} ou de regarder cette vidéo :\n\n<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/9Cfxm7cikMY\" frameborder=\"0\" allowfullscreen></iframe>\n\n\n### Créons notre première page\n\nComme AMP ce n'est jamais que du HTML nous allons commencer par la phase obligatoire : la mise en place des metas de notre page.\n\nCommençons par créer un fichier index.amp, puis mettons la balise indiquant le type de document.\n\n```html\n<!doctype html>\n```\nPuis nous ouvrons la balise html en y ajoutant l'option AMP.\n\n```html\n<!doctype html>\n<html ⚡>\n</html>\n```\nIl nous faut maintenant mettre les metas obligatoires.\n\n```html\n<!doctype html>\n<html ⚡>\n  <head>\n    <meta charset=\"utf-8\">\n    <title>Ma première page AMP</title>\n    <link rel=\"canonical\" href=\"http://test.fr/index.amp\" />\n    <meta name=\"viewport\" content=\"width=device-width,minimum-scale=1,initial-scale=1\">\n    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>\n    <script async src=\"https://cdn.ampproject.org/v0.js\"></script>\n  </head>\n  <body>\n    Ma première page AMP\n  </body>\n</html>\n```\nComme vous le constatez, on y retrouve :\n\n- l'encodage de votre page\n- le lien canonique qui contient soit l'url HTML de votre page, soit l'url AMP\n- le viewport de votre page\n- la balise style obligatoire pour prendre en compte AMP\n- le chargement de la librairie javascript AMP\n- le body de la page\n\nPour être présent dans la recherche AMP de Google comme vu précédemment, il faut mettre en place le [schema.org](http://schema.org/), dont vous trouverez de plus amples informations [ici](https://developers.google.com/search/docs/guides/intro-structured-data){:rel=\"nofollow noreferrer\"}.\n\n```html\n<!doctype html>\n<html ⚡>\n  <head>\n    <meta charset=\"utf-8\">\n    <title>Ma première page AMP</title>\n    <link rel=\"canonical\" href=\"http://test.fr/index.amp\" />\n    <meta name=\"viewport\" content=\"width=device-width,minimum-scale=1,initial-scale=1\">\n    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>\n    <script async src=\"https://cdn.ampproject.org/v0.js\"></script>\n    <script type=\"application/ld+json\">\n      {\n        \"@context\": \"http://schema.org\",\n        \"@type\": \"NewsArticle\",\n        \"headline\": \"Exemple AMP\",\n        \"datePublished\": \"2017-05-25T19:37:41Z\",\n      }\n    </script>\n  </head>\n  <body>\n    Ma première page AMP\n  </body>\n</html>\n```\nNous avons maintenant une page de base. Mais est-elle vraiment AMP ? Afin d'effectuer une vérification, AMP a mis en place deux systèmes. Le plus simple est directement online, à cette url [https://validator.ampproject.org/](https://validator.ampproject.org/){:rel=\"nofollow noreferrer\"}. Votre deuxième option est d'afficher votre page dans le navigateur en ajoutant \n```html\n#development=1\n```\nà votre url. Dans votre console chrome vous devriez maintenant voir les erreurs de validation.\n\nUne page web c'est bien, mais il faut y mettre du CSS. C'est aussi là que AMP est assez contraignant. Vous pouvez utiliser seulement un fichier CSS externe, sinon le CSS doit être dans une balise spécifique. Vous devez aussi définir explicitement la taille de chaque élément.\n\n```html\n<!doctype html>\n<html ⚡>\n  <head>\n    <meta charset=\"utf-8\">\n    <title>Ma première page AMP</title>\n    <link rel=\"canonical\" href=\"http://test.fr/index.amp\" />\n    <meta name=\"viewport\" content=\"width=device-width,minimum-scale=1,initial-scale=1\">\n    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>\n    <script async src=\"https://cdn.ampproject.org/v0.js\"></script>\n    <script type=\"application/ld+json\">\n      {\n        \"@context\": \"http://schema.org\",\n        \"@type\": \"NewsArticle\",\n        \"headline\": \"Exemple AMP\",\n        \"datePublished\": \"2017-05-25T19:37:41Z\",\n      }\n    </script>\n    <style amp-custom>\n      body {\n        background-color: white;\n      }\n      h1 {\n        color: red;\n      }\n      amp-img {\n        background-color: yellow;\n        border: 1px solid black;\n      }\n    </style>\n\n  </head>\n  <body>\n    <h1>Ma première page AMP</h1>\n    <div>\n      Salut tout le monde\n    </div>\n    <amp-img src=\"/wp-content/uploads/2017/05/logo-og-image.jpg\" alt=\"amp\" height=\"300\" width=\"500\"></amp-img>\n  </body>\n</html>\n```\nPour terminer notre page, il faut que Google sache que nous avons fait une page AMP, et pour cela rien de plus simple.\n\nDans votre HTML vous devez notifier que la page existe en ajoutant la meta suivante :\n\n\n```html\n<link rel=\"amphtml\" href=\"URL DE LA PAGE AMP\">\n```\n\nDans la page AMP vous devez mettre votre page HTML en ajoutant cette balise :\n\n```html\n<link rel=\"canonical\" href=\"URL DE LA PAGE HTML\">\n```\n\nSi vous n'avez qu'une page rien de plus vous n'avez qu'à mettre le lien canonique de votre page.\n\n### C'est fini\n\nBravo, vous avez fait un grand pas dans la web performance !\n\nIl existe de nombreuses autres fonctionnalités disponibles, telles que la mise en place [d'un système de login](https://www.ampproject.org/fr/docs/tutorials/login_requiring), un [live blog](https://www.ampproject.org/fr/docs/tutorials/live_blog) mais aussi de la publicité, de l'analytics... Je vous invite à regarder la page [https://www.ampproject.org/fr/docs/guides/](https://www.ampproject.org/fr/docs/guides/){:rel=\"nofollow noreferrer\"} qui  pourra vous inspirer pour votre application web.\n"}