{"date":"2011-10-23T00:00:00.000Z","title":"MongoDB pour PHP","excerpt":"Aujourd'hui, petit tuto pour installer MongoDB pour php5. Pour cela plusieurs étapes sont nécessaires aussi bien sur le serveur que sur la partie software. Sur ce tuto nous travaillons sur un ubuntu 10.10 lors de l'installation des différents softwares.","readingTime":"2mn","authors":["captainjojo"],"categories":["php"],"content":"Aujourd'hui, petit tuto pour installer MongoDB pour php5. Pour cela plusieurs étapes sont nécessaires aussi bien sur le serveur que sur la partie software.\nSur ce tuto nous travaillons sur un ubuntu 10.10 lors de l'installation des différents softwares.\n\n### Installation de MongoDB\n\nPour installer le serveur Mongo la meilleure solution est d'utiliser le package mongo fait pour ubuntu.\n\n```sh\nsudo apt-key adv --keyserver keyserver.ubuntu.com --recv 7F0CEB10\n```\nPuis ajouter la ligne suivante dans le fichier /etc/apt/source.list\n\n```sh\ndeb http://downloads-distro.mongodb.org/repo/ubuntu-upstart dist 10gen\n```\nPour terminer, lancer les deux commandes suivantes:\n\n```sh\nsudo apt-get update\nsudo apt-get install mongodb-10gen\n```\n\nSi tout c'est bien passé le message suivant doit apparaître:\n\n```sh\nAdding system user `mongodb' (UID 110) ...\nAdding new user `mongodb' (UID 110) with group `nogroup' ...\nNot creating home directory `/home/mongodb'.\nAdding group `mongodb' (GID 118) ...\nDone.\nAdding user `mongodb' to group `mongodb' ...\nAdding user mongodb to group mongodb\nDone.\nmongodb start/running, process 1937\n```\n\n### Installation d'un \"phpmyadmin\"\n\nMaintenant que le serveur mongo est lancé, il faut installer un \"phpmyadmin\" pour pouvoir interagir avec les données de MongoDB. Il existe de nombreux softwares pour cela:\n\n 1. phpmoadmin\n 2. obricot\n 3. rockmongo\n\nPour ce tuto nous allons installer rockmongo.\nCommençons par télécharger la dernière version de rockmongo.\n[rockmongo-v1.1.0](https://github.com/iwind/rockmongo){:rel=\"nofollow noreferrer\"}\n\nEnsuite il faut l'envoyer sur le serveur:\n\n```sh\nscp path_to_rockmongo.zip username@host:~\n```\n Puis on dezippe le dossier:\n\n```sh\nunzip rockmongo.zip\n```\n\nEnsuite il faut mettre la configuration de notre mongo dans le fichier config.php. Puis nous devons ajouter le virtualhost pour accéder à notre rockmongo, voici un exemple:\n\n```sh\n// etc/apache2/site-available/rockmongo\n<VirtualHost *:80>\n  ServerName rockmongo.host\n  ServerAlias rockmongo.host\n\n  DocumentRoot \"/home/rockmongo\"\n  DirectoryIndex index.php\n  <Directory \"/home/rockmongo\">\n    AllowOverride All\n    Allow from All\n  </Directory>\n\n  <DirectoryMatch .svn>\n    Order allow,deny\n    Deny from all\n  </DirectoryMatch>\n\n  RedirectMatch 403 /phpmyadmin(.*)\n\n</VirtualHost>\n```\n\nEnsuite comme d'habitude, on lance les commandes pour relancer apache2:\n\n```sh\nsudo a2ensite rockmongo\nsudo /etc/init.d/apache2 restart\n```\n\nSi tout c'est bien passé rockmongo est visible sur le navigateur à l'url choisi.\nPour la plupart, vous devez avoir le message suivant sur le navigateur:\n\n> To make things right, you must install php_mongo module.\n> [Here](http://www.php.net/manual/en/mongo.installation.php){:rel=\"nofollow noreferrer\"} for installation documents on PHP.net.\n\n### Installation de mongo pour php\n\nCela reste très simple, lancer la commande\n\n```sh\nsudo pecl install mongo\n```\n\nUne fois la commande lancée, il faut ajouter la ligne suivante:\n\n> extension=mongo.so\n\nDans les fichiers /etc/php5/cli/php.ini et /etc/php5/apache2/php.ini\nVous pouvez dès maintenant utiliser MongoDb dans votre projet PHP. Pour cela voici un exemple d'utilisation.\n\n```php\n<?php\n\n// Permet la connexion à MongoDb\n$m = new Mongo();\n\n// Sélectionner la base\n$db = $m->test;\n\n// Puis la collection (qui correspond à une table sur mysql)\n$collection = $db->user;\n\n// Ajout d'un utilisateur dans la base\n$obj = array( \"name\" => \"jonathan\", \"password\" => \"test\" );\n$collection->insert($obj);\n\n// Permet de rechercher tous les éléments d'une collection\n$cursor = $collection->find();\n\n// Et enfin une petite boucle\nforeach ($cursor as $obj) {\n    echo $obj[\"title\"] . \"n\";\n}\n\n?>\n```\nCe tuto est terminé, surtout s'il vous a aidé, partagez-le sur vos facebook :)\n"}