{"date":"2016-12-23T00:00:00.000Z","title":"Comprendre le SSL/TLS: Partie 5 Record Protocol","excerpt":"Record protocol","readingTime":"4mn","authors":["ibenichou"],"categories":[],"content":"\n# Record protocol\n\nCe protocole a pour buts :\n* **Encapsulation**  - permet aux données SSL / TLS d'être transmises et reconnues sous une forme homogène ;\n* **Confidentialité** - assure que le contenu du message ne peut pas être lu par un tiers : les données sont chiffrées en utilisant les clés produites lors de la négociation ;\n* **Intégrité et Identité** - permet de vérifier la validité des données transmises, grâce aux signatures HMAC : cette signature est elle aussi générée à l'aide des clés produites lors de la négociation.\n\nVoici en détail comment se déroule le record protocole :\n\n<img src=\"/imgs/posts/2016-12-23-comprendre-ssl-tls-partie-5-record-protocol/ssl_intro_fig3.jpg\" />\n\n1. Segmentation - les données sont découpées en blocs de taille inférieure à 16 384 octets ;\n2. Compression - les données sont compressées en utilisant l'algorithme choisi lors de la négociation.\nA noter : à partir de SSL 3.0, il n'y a plus de compression.\n3. Signature HMAC (0, 16 ou 20 octets) - une signature des données est générée à l'aide de la clé MAC. Elle est calculée de la manière suivante :\n```\nHASH(\n\n       write mac secret\n\n       | pad_2\n\n       | HASH(\n\n                 write mac secret\n\n                 | pad_1\n\n                 | numéro de ce message\n\n                 | protocole pour ce message\n\n                 | longueur de ce message\n\n                 | données compressées\n\n                 )\n\n         )\n```\n\n    * La fonction HASH() est soit MD5 soit SHA-1.\n    * pad_1 et pad_2 sont des mots de remplissage (pad_1 = 0x36 et pad_2 = 0x5C (répétés 40 fois pour SHA-1 et 48 fois pour MD5))\n4. Chiffrement - le paquet obtenu est chiffré à l'aide de la fonction récupérée lors de la négociation ;\n5. Un en-tête de 5 octets est ajouté. Le champ “Type” de cet en-tête définit le type du protocole de niveau supérieur au Record Protocol. Les types sont les suivants:\n\n```\nContent-Type (1 octet) – Indique le type de paquet SSL et TLS contenu dans l’enregistrement :\n0x20 – Paquet de type Change Cipher Spec\n0x21 – Paquet de type Alert\n0x22 – Paquet de type Handshake\n0x23 – Paquet de type Application Data : ce type correspond aux données effectives de la transaction SSL.\n```\n\nÀ la réception des paquets, le destinataire effectue les opérations suivantes :\n1. Vérification de l'en-tête SSL/TLS\n2. Déchiffrage du paquet\n3. Vérification du champ HMAC (en appliquant la même fonction que celle décrite ci-dessus, aux données déchiffrées puis en comparant le résultat au HMAC reçu)\n4. Décompression des données\n5. Ré-assemblage des parties\n\nSi ça se passe mal au cours de ces vérifications, alors une alarme est générée.\n\n# Outils:\n\n**OpenSSL** :\n\nImplémenté en C, OpenSSL est une boîte à outils de chiffrement comportant deux bibliothèques (une de cryptographie générale et une qui implémente le protocole SSL), ainsi qu'une commande en ligne. OpenSSL est distribué sous une licence de type Apache.\n\n**GnuTLS** :\n\nLe projet GnuTLS propose une implémentation du protocole TLS conforme aux spécifications de l'IETF. Il permet l'authentification via les certificats X509 et PGP. À la différence d'OpenSSL, GnuTLS est compatible avec les licences GPL.\n\nSi vous souhaitez tester votre certificat, vous pouvez utiliser [SSLlab](https://www.ssllabs.com/){:rel=\"nofollow noreferrer\"}.\n\n**Conclusion** :\n\nLe protocole SSL / TLS n’est pas facile à prendre en main car il touche énormément de choses différentes et complexes. Cependant, je trouve très intéressant de voir le “côté obscur” de ce protocole afin de comprendre les notions que celui-ci met en place. Dans cette série d’articles, j’ai essayé de vous montrer toutes les phases importantes à savoir : le chiffrement, le certificat et les sous-protocoles, afin que vous ne soyez plus perdu quand on vous parle de SSL / TLS (que vous ayez compris les principes).\nToutefois, si vous mettez en place un certificat SSL sur votre site, cela ne vous garantira pas à 100% que celui-ci est sécurisé. Pour exemple récent, le faille connue sous le nom de [Heartblee](https://fr.wikipedia.org/wiki/Heartbleed){:rel=\"nofollow noreferrer\"} qui a ébranlé tout le web.\n"}