{"date":"2018-03-21T00:00:00.000Z","title":"Calabash / Cucumber - Ecrire des tests fonctionnels pour Mobile","excerpt":"Rendez plus robuste votre application mobile en ajoutant des tests fonctionnels","readingTime":"19mn","authors":["ibenichou"],"categories":[],"content":"\nNous allons voir aujourd'hui comment mettre en place des tests fonctionnels sur votre application.\nCet article va vous permettre notamment de sensibiliser vos PO à écrire des tests afin d'automatiser les sanity checks.\n\nPour argumenter auprès de votre PO, je vous conseille de lui partager l'article de [Thiga](https://blog.thiga.fr/product-management/bdd-gherkin-pour-ecrire-vos-user-stories/)\n\n> Pré-requis: avoir des bases en Ruby ; Ruby 2.3.3 sur votre machine ; Bundler\n\n## Cucumber\n\n[Cucumber](https://cucumber.io/) est un framework [open-source](https://github.com/cucumber/cucumber) qui permet d'exécuter des tests automatisés.\n\nCe framework repose sur le principe du Behaviour-Driven Development (BDD).\n\n> Le processus BDD met en avant le langage naturel et les interactions dans le processus de développement logiciel.\n\nEn clair, Cucumber vous permet d'exprimer le comportement de votre application en utilisant un langage naturel (Gherkin) qui peut être compris par tout le monde. Cela permet également d'obtenir une documentation fonctionnelle de votre application.\n\nExemple :\n\n![Cucumber](/imgs/posts/2018-03-01-calabash-cucumber/cucumber-feature@2x.png)\n\n### Comment ça marche ?\n\nUn morceau de code Ruby est exécuté pour chaque ligne de test.\n\nLe diagramme suivant illustre comment toutes ces pièces s'emboîtent :\n\n![cucumberSchema](/imgs/posts/2018-03-01-calabash-cucumber/image-02.png)\n\nLes `steps definitions` utilisent les API Calabash (Ruby) pour interagir avec l'application lorsqu'elle s'exécute sur un périphérique ou dans le simulateur. Les API contiennent des méthodes pour simuler des actions de l'utilisateur, telles que toucher l'écran, entrer du texte dans des champs de texte, etc.\n\n## Calabash\n\n[Calabash](https://calaba.sh/) est open-source, développé et maintenu par [Xamarin](https://github.com/calabash/calabash-ios).\n\nIl est constitué de bibliothèques qui permettent au code de test d’interagir par programmation avec des applications natives et hybrides.\n\nNous allons voir tout ça en détails dans la suite de l'article.\n\n### Cucumber - Calabash\n\nCucumber est un cadre générique pour les tests. Il nécessite une bibliothèque d'automatisation qui se connecte et permet à Cucumber de s'exécuter sur une plateforme ou une technologie particulière.\nCette architecture permet d'écrire des tests Cucumber pour presque n'importe quel dispositif, à condition qu'il existe une bibliothèque d'automatisation qui assure la prise en charge du dispositif en question.\n\nSchéma Cucumber / Calabash:\n\n![stackCucumberCalabash](/imgs/posts/2018-03-01-calabash-cucumber/image-01.png){:height=\"600px\"}\n\nSchéma sur le fonctionnement sur device / simulateur.\n\n![iosCalabash](/imgs/posts/2018-03-01-calabash-cucumber/calabash-ios-stack.png){:height=\"500px\"}\n\nLe framework Calabash fournit un petit serveur HTTP intégré qui permet aux tests de communiquer et de contrôler l'application pendant qu'elle s'exécute sur le périphérique. Cependant, le framework Calabash ne doit pas être inclus dans les versions Release de l'IPA.\n\n## Installation\n\n### Dépendances Ruby\n\nCréez un fichier `Gemfile` à la racine de votre projet afin d'installer le [gem](https://rubygems.org/gems/calabash-cucumber/versions/0.21.4?locale=fr) `calabash-cucumber` pour les dépendances de ligne de commande qui vont nous permettre de lancer nos tests.\n\n```ruby\nsource \"https://rubygems.org\"\n\nruby '2.3.3' # On fixe la version de ruby\n\ngem 'calabash-cucumber', '~> 0.21.4'\n```\n\nPour l'installer, rien de plus simple, tapez dans votre terminal : `bundle install`\n\n### Target Calabash sous Xcode\n\nÀ noter : il faut absolument créer une nouvelle target `-cal` pour lancer vos tests.\n\n**Step 1 - Création de la target -cal**\n\nCliquez droit sur la target de production et dupliquez celle-ci :\n\n![Step1](https://cloud.githubusercontent.com/assets/466104/10642073/6cfbd6cc-781c-11e5-91c5-ecb5dffc4a14.png)\n\nSi vous avez une application pour iPhone ou iPad uniquement, vous pouvez avoir une alerte de ce type :\n\n(Cliquez sur \"Duplicate Only\")\n\n![alert](https://cloud.githubusercontent.com/assets/466104/10642075/7079fd42-781c-11e5-9487-93deaf47c03b.png)\n\nDans ce cas, renommez la target en rajoutant à la fin `-cal` :\n\n![renameCal](https://cloud.githubusercontent.com/assets/466104/10642082/7998f5fe-781c-11e5-8cca-354c4651fc79.png)\n\nChangez son bundle identifier :\n\n![changeBundlerIdentifier](https://cloud.githubusercontent.com/assets/466104/10642083/79b15a2c-781c-11e5-844a-92ebe29e6e9c.png)\n\nChangez le `Info.plist` pour mettre l'original :\n\n![infoPlis](https://cloud.githubusercontent.com/assets/466104/10642086/79bf2580-781c-11e5-9415-0313ebfcfc51.png)\n\nSupprimez le `Info.plist` dupliqué :\n\n![duplicateInfoPlist](https://cloud.githubusercontent.com/assets/466104/10642085/79bf10d6-781c-11e5-9e53-57935455b87e.png)\n\n**Step 2 - Créez le schéma -cal**\n\nGérez le schéma :\n\n![manageScheme](https://cloud.githubusercontent.com/assets/466104/10642084/79bc4ca2-781c-11e5-86de-6fc8f25d45eb.png)\n\nVérifiez les options \"Show\" et \"Share\" :\n\n![showShareScheme](https://cloud.githubusercontent.com/assets/466104/10642089/79c0e64a-781c-11e5-9e4e-25b91fa10d8c.png)\n\n**Step 3 - Link CFNetwork.framework**\n\nSi votre application de production n'est pas déjà `linker` avec `CFNetwork.framework`, vous devez ajouter celle-ci à la target `-cal`. Cette étape est nécessaire pour que le framework Calabash automatise l'application testée.\n\n![linkCFNetwork](https://cloud.githubusercontent.com/assets/466104/10642090/79c952b2-781c-11e5-83a1-17bcb8719b58.png)\n![addLinkCFNetwork](https://cloud.githubusercontent.com/assets/466104/10642091/79d07010-781c-11e5-84fa-da3bb2f9950e.png)\n\n### Podfile\n\nNous allons maintenant installer le pod `Calabash` sur votre projet.\nVous devez créer votre fichier Podfile via `pod init` à la racine de votre projet et ajouter à votre target -cal le pod `Calabash`.\n\nExemple :\n\n```ruby\nplatform :ios, '10.0'\n\ntarget 'calabashCucumber' do\n  use_frameworks!\n  pod 'SwiftMessages'\nend\n\ntarget 'calabashCucumber-cal' do\n  use_frameworks!\n\n  pod 'SwiftMessages'\n  pod 'Calabash'\nend\n\n```\n\nEnsuite, installez-le via `pod install` et n'oubliez pas d'ouvrir le projet en `*.xcworkspace`.\n\nVoilà, nous avons terminé la configuration ! Cette partie semble longue comme ça, je vous l'accorde, mais à force de pratiquer ça vous prendra peu de temps.\n\n## Génération de fichier features et scripts Ruby\n\nMaintenant, il est temps de rentrer dans le vif du sujet. Dans votre terminal, à la racine du projet, lancez la commande suivante :\n\n```shell\nbundle exec calabash-ios gen\n```\n\nAprès avoir répondu `Y` à la question, vous pourrez constater que cette commande crée un dossier `features` contenant plusieurs sous-dossiers/fichiers :\n\n* `steps/samples_step.rb`: Répertoire contenant les fichiers Ruby qui traduisent les tests [Gherkin](https://github.com/cucumber/cucumber/wiki/Gherkin) ;\n* `support`: Répertoire, avec plus de scripts Ruby qui font fonctionner l'ensemble de l'automatisation ;\n* `*.features`: Fichier test écrit en [Gherkin](https://github.com/cucumber/cucumber/wiki/Gherkin).\n\n> Attention ! Pensez bien à builder une première fois votre target -cal avant de lancer les tests.\n\nPour lancer les tests, tapez la commande :\n\n```shell\nbundle exec cucumber\n```\n\nMagique, non ? :)\n\n## Gherkin - Cucumber\n\nNous allons partir du principe que vous travaillez avec un PO exceptionnel qui connaît le Gherkin !\nIl rédige donc les scénarios d'acceptation de test de chaque écran dans des fichiers `.features`\n\nAide :\n\n![Gerhkins](/imgs/posts/2018-03-01-calabash-cucumber/gherkincheat.png){:height=\"600px\"}\n\n> Les scripts Gherkins ci-dessous peuvent être optimisés mais j'ai préféré vous présenter quelque chose de simple :)\n\n### Accueil\n\nNous allons donc créer notre premier fichier `home.feature`.\n\nVoici la première version de cette feature en Français :\n\n```gherkin\nFeature: Page d'accueil\n  Scenario: Message de bienvenue\n  Etant donné que je lance l'application\n  Quand je ne fais rien\n  Alors je dois voir \"Welcome\" en titre\n\n  Scenario: Bouton Login\n  Etant donné que je lance l'application\n  Quand je ne fais rien\n  Alors je dois voir \"Login\" comme bouton\n\n  Scenario: Bouton Register\n  Etant donné que je lance l'application\n  Quand je ne fais rien\n  Alors je dois voir \"Register\" comme bouton\n```\n\nJe vous conseille de lire la documentation sur les [steps prédéfinies](https://github.com/calabash/calabash-ios/wiki/02-Predefined-steps) de Cucumber. Ces steps vous offrent un moyen rapide et facile de commencer à tester votre application sans avoir à programmer ; comme lorsque vous voulez cliquer sur un bouton, écrire dans un textfield...\n\nCependant, vous pouvez facilement écrire vos `custom steps` comme `Then I should see the button \"Login\"` dans `home.feature`.\n\n```gherkin\nFeature: Home\n\nScenario: Home Welcome\n  Given the app has launched\n  When I do nothing\n  Then I should see \"Welcome\"\n\nScenario: Login Button\n  Given the app has launched\n  When I do nothing\n  Then I should see the button \"Login\"\n\nScenario: Register Button\n  Given the app has launched\n  When I do nothing\n  Then I should see the button \"Register\"\n```\n\n### Login\n\n```gherkin\nFeature: Login\n\nScenario: Login Screen\n  Given I press \"Login\"\n  When I do nothing\n  Then I should see \"Login\"\n\nScenario: Email TextField\n  Given I press \"Login\"\n  When I do nothing\n  Then I should see \"email\"\n\nScenario: Password TextField\n  Given I press \"Login\"\n  When I do nothing\n  Then I should see \"mot de passe\"\n\nScenario: Login Button\n  Given I press \"Login\"\n  When I do nothing\n  Then I should see \"Login\"\n\nScenario: Fermer Button\n  Given I press \"Login\"\n  When I do nothing\n  Then I should see \"Fermer\"\n\nScenario: Fermer Button action\n  Given I press \"Login\"\n  When I press \"Fermer\"\n  Then I should see \"Welcome\"\n\nScenario: No Valid form without info\n  Given I press \"Login\"\n  When I press \"Login\"\n  Then I should see \"Please, add a email and a password\"\n\nScenario: No Valid form without valid email\n  Given I press \"Login\"\n  When I use the native keyboard to enter \"mail@mail\" into the \"email\" input field\n  Then I touch done\n  And I press \"Login\"\n  And I should see \"Please, add a validate email\"\n\nScenario: No Valid form with small password\n  Given I press \"Login\"\n  When I use the native keyboard to enter \"mail@mail.fr\" into the \"email\" input field\n  And I use the native keyboard to enter \"123\" into the \"mot de passe\" input field\n  Then I touch done\n  And I press \"Login\"\n  And I should see \"Please, enter a password sup to 3 char\"\n\nScenario: Email and password not match\n  Given I press \"Login\"\n  When I use the native keyboard to enter \"mail@mail.fr\" into the \"email\" input field\n  And I use the native keyboard to enter \"1235\" into the \"mot de passe\" input field\n  Then I touch done\n  And I press \"Login\"\n  Then I should see \"Login and password dont match\"\n\nScenario: Success login\n  Given I press \"Login\"\n  When I use the native keyboard to enter \"mail@mail.fr\" into the \"email\" input field\n  And I use the native keyboard to enter \"1234\" into the \"mot de passe\" input field\n  Then I touch done\n  And I press \"Login\"\n  And I should see \"Home\"\n```\n\n### Inscription\n\n```gherkin\nFeature: Register\n\nScenario: Register Screen\n  Given I press \"Register\"\n  When I do nothing\n  Then I should see \"Register\"\n\nScenario: Email TextField\n  Given I press \"Register\"\n  When I do nothing\n  Then I should see \"email\"\n\nScenario: Password TextField\n  Given I press \"Register\"\n  When I do nothing\n  Then I should see \"mot de passe\"\n\nScenario: Password Copy TextField\n  Given I press \"Register\"\n  When I do nothing\n  Then I should see \"recopy mot de passe\"\n\nScenario: Register Button\n  Given I press \"Register\"\n  When I do nothing\n  Then I should see \"Register\"\n\nScenario: Fermer Button\n  Given I press \"Register\"\n  When I do nothing\n  Then I should see \"Fermer\"\n\nScenario: No Valid form without info\n  Given I press \"Register\"\n  When I press \"Register\"\n  Then I should see \"Please, add a email and a password\"\n\nScenario: No Valid form without valid email\n  Given I press \"Register\"\n  When I use the native keyboard to enter \"mail@mail\" into the \"email\" input field\n  Then I touch done\n  And I press \"Register\"\n  And I should see \"Please, add a validate email\"\n\nScenario: No Valid form with small password\n  Given I press \"Register\"\n  When I use the native keyboard to enter \"mail@mail.fr\" into the \"email\" input field\n  And I use the native keyboard to enter \"123\" into the \"mot de passe\" input field\n  Then I touch done\n  And I press \"Register\"\n  Then I should see \"Please, enter a password sup to 3 char\"\n\nScenario: No Valid form with small password\n  Given I press \"Register\"\n  When I use the native keyboard to enter \"mail@mail.fr\" into the \"email\" input field\n  And I use the native keyboard to enter \"1234\" into the \"mot de passe\" input field\n  And I use the native keyboard to enter \"1235\" into the \"recopy mot de passe\" input field\n  Then I touch done\n  And I press \"Register\"\n  Then I should see \"Your password its not same\"\n\nScenario: Success login\n  Given I press \"Register\"\n  When I use the native keyboard to enter \"mail@mail.fr\" into the \"email\" input field\n  And I use the native keyboard to enter \"1234\" into the \"mot de passe\" input field\n  And I use the native keyboard to enter \"1234\" into the \"recopy mot de passe\" input field\n  Then I touch done\n  And I press \"Register\"\n  Then I should see \"Home\"\n\n# J'ai ajouté ce scénario pour provoquer un failed.\nScenario: Test Failed Scenario\n  Given I press \"Register\"\n  When I use the native keyboard to enter \"mail@mail.fr\" into the \"email\" input field\n  And I use the native keyboard to enter \"1234\" into the \"mot de passe\" input field\n  And I use the native keyboard to enter \"1234\" into the \"recopy mot de passe\" input field\n  Then I touch done\n  And I press \"Register\"\n  Then I should see \"Pepito\"\n```\n\n## Ruby - Calabash\n\nRappelez-vous que dans `home.feature`, j'ai délibérément ajouté quelques `custom steps` :\n\n* Given the app has launched\n* When I do nothing\n* I should see the button \"Login\"\n\nVous pouvez vous aider de la documentation pour écrire des `custom steps` plus poussées :\n\n* http://calabashapi.xamarin.com/ios/\n* https://developer.xamarin.com/guides/testcloud/calabash/calabash-query-syntax/\n\n### Home.rb\n\n```ruby\nGiven(/^the app has launched$/) do\n    wait_for do # Attend une intruction qui retourne true, sinon un timeout lève une exception.\n      !query(\"*\").empty?\n    end\nend\n\nWhen(/^I do nothing$/) do # Ne fait rien.\nend\n\nThen(/^I should see the button \"([^\"]*)\"$/) do |txt|\n    wait_for_element_exists(\"button marked:'#{txt}'\") # Attend d'avoir un élément button avec la valeur \"txt\". Un timeout lève une exception s'il n'a rien trouvé.\nend\n```\n\n**Query**\n\n`Query` sélectionne un ou plusieurs objets de la vue \"visible\" dans l'écran actuel de votre application. Cette méthode prend un argument `String` qui décrit les objets à \"interroger\".\n\n`Query` donne une approche \"CSS-selector\" pour trouver des objets de vue dans les écrans de votre application.\n\n**Exécutez vos tests**\n\nSi vous lancez votre test `bundle exec cucumber -n Home` pour `home.feature` vous devriez obtenir quelque chose comme ça.\n\n![homeFeatureCli](/imgs/posts/2018-03-01-calabash-cucumber/screen_home_feature.png){:width=\"900px\"}\n\nCool non ? :)\n\n## Application\n\nPour cet article j'ai mis sur [github](https://github.com/Prims47/CalabashCucumber) mon application, qui comporte une page d'inscription/login/home.\n\n> Attention ! J'ai construit rapidement cette application pour cet article, donc j'accepte volontiers toutes pull requests :)\n\n### Screenshots\n\n![appHome](/imgs/posts/2018-03-01-calabash-cucumber/simuHome.png){:height=\"500px\"}\n![appLogin](/imgs/posts/2018-03-01-calabash-cucumber/SimuLogin.png){:height=\"500px\"}\n![appLoginError](/imgs/posts/2018-03-01-calabash-cucumber/SimoLoginError.png){:height=\"500px\"}\n![appRegister](/imgs/posts/2018-03-01-calabash-cucumber/SimuRegister.png){:height=\"500px\"}\n![appRegisterError](/imgs/posts/2018-03-01-calabash-cucumber/SimuRegisterError.png){:height=\"500px\"}\n![appHome2](/imgs/posts/2018-03-01-calabash-cucumber/SmuHome2.png){:height=\"500px\"}\n\n### Login Validation\n\n```swift\nvar formIsValid = false\n\nfunc validForm(email: String, password: String) -> Bool {\n    if email == \"\" && password == \"\" {\n        Message.showError(error: \"Please, add a email and a password\")\n\n        return false\n    }\n\n    if !self.isValidEmail(email: email) {\n        Message.showError(error: \"Please, add a validate email\")\n\n        formIsValid = false\n    }\n\n    if password.count < 4 {\n        Message.showError(error: \"Please, enter a password sup to 3 char\")\n\n        return false\n    }\n\n    if email != \"mail@mail.fr\" || password != \"1234\" {\n        Message.showError(error: \"Login and password dont match\")\n\n        return false\n    }\n\n    if email == \"mail@mail.fr\" && password == \"1234\" {\n        formIsValid = true\n    }\n\n    return formIsValid\n}\n\nfunc isValidEmail(email: String) -> Bool {\n    let emailRegEx = \"[A-Z0-9a-z._%+-]+@[A-Za-z0-9.-]+\\\\.[A-Za-z]{2,64}\"\n\n    let emailTest = NSPredicate(format:\"SELF MATCHES %@\", emailRegEx)\n\n    return emailTest.evaluate(with: email)\n}\n```\n\n### Inscription Validation\n\n```swift\nfunc validForm(email: String, password: String, copyPass: String) -> Bool {\n    if email == \"\" && password == \"\" && copyPass == \"\" {\n        Message.showError(error: \"Please, add a email and a password\")\n\n        return false\n    }\n\n    if !self.isValidEmail(email: email) {\n        Message.showError(error: \"Please, add a validate email\")\n    }\n\n    if password.count < 4 {\n        Message.showError(error: \"Please, enter a password sup to 3 char\")\n\n        return false\n    }\n\n    if password != copyPass {\n        Message.showError(error: \"Your password its not same\")\n\n        return false\n    }\n\n    return true\n}\n\nfunc isValidEmail(email: String) -> Bool {\n    let emailRegEx = \"[A-Z0-9a-z._%+-]+@[A-Za-z0-9.-]+\\\\.[A-Za-z]{2,64}\"\n\n    let emailTest = NSPredicate(format:\"SELF MATCHES %@\", emailRegEx)\n\n    return emailTest.evaluate(with: email)\n}\n```\n\n### Message\n\nJ'ai ajouté à mon projet la librairie `SwiftMessages` pour customiser mes erreurs.\n\n```swift\nstruct Message {\n    static func showError(error: String) {\n        var config = SwiftMessages.Config()\n        config.duration = .seconds(seconds: 3)\n        config.presentationContext = .window(windowLevel: UIWindowLevelStatusBar)\n\n        let view = MessageView.viewFromNib(layout: .messageViewIOS8)\n        view.configureTheme(.error, iconStyle: .subtle)\n        view.configureContent(title: \"Erreur\", body: error)\n\n        SwiftMessages.show(config: config, view: view)\n    }\n}\n```\n\n## Bonus - Aws farm device\n\nAws dispose d'un service nommé `Device Farm` qui permet de lancer différents tests sur un [parc de téléphones](https://aws.amazon.com/fr/device-farm/device-list/) très vaste. Les avantages de cette solution sont multiples mais l'argument principal est que vous pouvez facilement cibler un device pour vos tests.\nVérifiez que vous avez bien configuré un compte AWS et un utilisateur IAM pour accéder à Device Farm.\n\n> Attention ! Aws avec Calabash ne supporte que des versions en dessous de 10.3.3.\n\n\n### Préparation\n\nNous devons préparer certaines choses avant de configurer AWS.\n\n**Création du build**\n\nVous allez devoir créer un .ipa de votre application. Assurez-vous que celui-ci soit conçu pour un appareil iOS et non pour un simulateur.\n\nSuivez les étapes suivantes :\n\n* Sélectionnez votre target `-cal` avec `Generic iOS Device`\n* Allez dans le menu `Product` > `Archive`\n* Dans la fenêtre qui vient d'apparaître, sélectionnez `Export` et `Development`\n* Laissez le reste par défaut\n\nVous devriez avoir un beau fichier .ipa :)\n\n**Compressez vos tests**\n\nAssurez-vous que vos tests Calabash soient contenus dans un fichier .zip. Celui-ci doit comporter la structure suivante :\nPensez donc bien à renommer votre dossier `steps` en `step_definitions`.\n\n```\nmy-zip-file-name.zip\n    `-- features (directory)\n          |-- my-feature-1-file-name.feature\n          |-- my-feature-2-file-name.feature\n          |-- my-feature-N-file-name.feature\n          |-- step_definitions (directory)\n          |      `-- (.rb files)\n          |-- support (directory)\n          |      `-- (.rb files)\n          `-- (any other supporting files)\n```\n\n### Configuration\n\nNous allons voir ensemble comment configurer le projet.\n\n**Step 1 - Création du projet**\n\nConnectez-vous à la console Device Farm sur l'adresse suivante : https://console.aws.amazon.com/devicefarm.\nSur la page de la console Device Farm, entrez un nom pour votre projet.\n\n![createProject](https://docs.aws.amazon.com/fr_fr/devicefarm/latest/developerguide/images/aws-device-farm-create-project.png)\n\nSi le bouton `Create a new run` s'affiche, choisissez-le.\n\n\n**Step 2 - Uploader votre ipa**\n\nVous devez uploader votre .ipa précédemment créée :\n\n![uploadIpa](/imgs/posts/2018-03-01-calabash-cucumber/upload_ipa.png)\n\nAmazon nous indique quelques informations à propos de votre build :\n\n![uploadIpaVersion](/imgs/posts/2018-03-01-calabash-cucumber/upload_ipa_version.png)\n\n**Step 3 - Uploader vos tests Calabash**\n\nSélectionnez Calabash et uploadez votre dossier .zip :\n\n![uploadCalabash](/imgs/posts/2018-03-01-calabash-cucumber/upload_calabash.png)\n\n**Step 4 - Pool de Devices**\n\nJ'ai délibérément mis mon build en target iOS 10.3, c'est pourquoi la sélection `Top Devices` d'Amazon apparaît en rouge.\n\n![poolError](/imgs/posts/2018-03-01-calabash-cucumber/pool_error.png)\n\nCependant, vous pouvez bien sûr créer votre propre pool.\n\n![poolCreate](/imgs/posts/2018-03-01-calabash-cucumber/pool_create.png)\n![poolSuccess](/imgs/posts/2018-03-01-calabash-cucumber/pool_success.png)\n\n**Step 5 - Configuration Devices**\n\nUn des nombreux avantages d'AWS Device Farm est que vous pouvez configurer vos devices.\nEn effet, on remarque via l'image ci-dessous qu'Amazon nous permet de :\n\n* Fournir des données supplémentaires qui seront utilisées par Device Farm lors de l'exécution. `Add extra data`, choisissez Upload, puis recherchez et choisissez le fichier .zip.\n* Installer une application supplémentaire qui sera utilisée par Device Farm lors de l'exécution. Choisissez `Install other apps`, puis Upload. Enfin, recherchez et sélectionnez le fichier .ipa contenant l'application. Répétez la procédure pour toutes les applications supplémentaires que vous voulez installer. Vous pouvez modifier l'ordre d'installation en faisant glisser et en déplaçant les applications ;\n* Pré-sélectionner la latitude et la longitude de l'appareil ;\n* Pré-sélectionner les paramètres régionaux de l'appareil pour l'exécution ;\n* Pré-définir le profil réseau de l'exécution, choisissez un profil dans `Network profil` ou choisissez `Create a new profile` pour créer le vôtre.\n\n![deviceState](/imgs/posts/2018-03-01-calabash-cucumber/device_state.png)\n\n**Step 6 - Run**\n\nAvant de lancer les tests, Amazon vous demande le temps (en minutes) maximum par devices qu'il doit prendre. Bien évidemment, ce temps dépend de vos tests ; dans mon cas, j'ai mis une valeur large de 30 minutes.\n\n![runExec](/imgs/posts/2018-03-01-calabash-cucumber/run_exec_time.png)\n\n### Tableau de bord\n\nAu bout de X minutes, lorsque vos tests sont terminés, si vous allez dans le détail de votre projet, Amazon va créer un dashboard hyper complet.\n\n![dashboard](/imgs/posts/2018-03-01-calabash-cucumber/dashboard.png)\n\nDans notre cas, Amazon nous montre directement quel scénario ne fonctionne pas. En quelques clics, nous pouvons rentrer en détails sur chaque device et chaque scénario. Amazon nous fournit pas mal d’éléments comme :\n\n* Vidéo du scénario exécuté ;\n* Logs (tableau + filtrer) ;\n* Perfomance (CPU, Mémoire, Threads) ;\n* Screenshots\n\nQui permettent de débugger plus facilement.\n\n### Conclusion du service Device Farm\n\nCependant, on remarque deux contraintes à cette solution :\n\n* Aws Device Farm ne supporte pas les versions supérieures à iOS 10.3.3\n* [Le prix](https://aws.amazon.com/fr/device-farm/pricing/), même si normalement c'est à votre société de prendre en charge cette partie :)\n\n## Conclusion\n\nCalabash et Cucumber forment un combo de feu pour la stabilisation de vos apps (avec des [tests unitaires](https://blog.eleven-labs.com/fr/test-unitaire-swift-xcode/) bien sûr !). Ajoutez avec ça un AWS Device Farm, et vous pourrez parfaitement tester votre application sur l'ensemble des devices du marché.\n\nLes avantages que j'ai remarqués sont :\n\n* Faciliter vos campagnes de test de non regression de façon automatique ;\n* Avoir de la documentation fonctionnelle de votre application ;\n* Permet de tester sur un ensemble de device sans avoir à tout acheter obligatoirement.\n\nLe seul \"défaut\" que j'ai trouvé, c'est la configuration qui nécessite un peu de temps au début.\n"}